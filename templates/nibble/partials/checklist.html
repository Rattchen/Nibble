<div>
    {% include "nibble/forms/checklist_field.html" with checklist=checklist checklist_id=checklist.id field_name='name' field_value=checklist.name %} 
    <button class="btn btn-primary" type="button" data-bs-toggle="collapse"
        data-bs-target="#collapseChecklist{{checklist.id}}" aria-expanded="false" aria-controls="collapseChecklist{{checklist.id}}">
        v
    </button>
</div>

<div class="collapse show" id="collapseChecklist{{checklist.id}}">
    <div class="card card-body">
        <ul class="list-group">

            {% for task in checklist.tasks.all %}

            <li class="list-group-item" id="checklist{{checklist.id}}">
                <input class="form-check-input me-1" type="checkbox" value="" id="Checkbox{{task.id}}For{{checklist.id}}">
                <label class="form-check-label" for="Checkbox{{task.id}}For{{checklist.id}}"
                    hx-swap="outerHTML">
                    {% if task.priority %}
                    <span>
{% include "nibble/forms/task_field.html" with task=task task_id=task.id field_name='priority' field_value=task.priority %} 
                    </span>
                    {% endif %}
                    <span>
{% include "nibble/forms/task_field.html" with task=task task_id=task.id field_name='name' field_value=task.name %} 
                    </span>
                    {% if task.due_datetime %}
                    <span>📅
{% include "nibble/forms/task_field.html" with task=task task_id=task.id field_name='due_datetime' field_value=task.due_datetime %}
                        🕕</span>
                    {% endif %}
                    <span class="badge text-bg-primary rounded-pill">
{% include "nibble/forms/task_field.html" with task=task task_id=task.id field_name='points' field_value=task.points %}                         pts</span>
                    {% if task.assigned_to %}
                    <span class="task-assigned">
{% include "nibble/forms/task_field.html" with task=task task_id=task.id field_name='assigned_to' field_value=task.assigned_to %}
                    </span>
                    {% else %}
                    <span>
{% include "nibble/forms/task_field.html" with task=task task_id=task.id field_name='task_type' field_value=task.task_type %} 
</span> 
                    {% endif %}

                    {% empty %}
                    Add a task and start planning your big heist!
                {% endfor %}
                </label>
            </li>
        </ul>

        <!-- Input to add a new task -->

        <hr />


    <form hx-post="{% url 'nibble:task_create' %}" hx-target="#collapseChecklist{{checklist.id}}" hx-swap="beforeend" hx-on::after-request="this.reset();" class="swappableClass">
        {% csrf_token %}
        <div class="input-group mb-3">
            <div class="form-floating"> 
                <select class="form-select" id="selectPriority" name="priority">
                    <option selected>None</option>
                    <option value="1">🔴</option>
                    <option value="2">🟠</option>
                    <option value="3">🟡</option>
                    <option value="4">🟢</option>
                </select>
                <label for="selectPriority">Priority</label>
            </div>

            <div class="form-floating"> 
                <select class="form-select" id="selectTaskType" name="taskType">
                    <option selected>None</option>
                    <option value="1">🎨 Grafika</option>
                    <option value="2">✒️ Tekst</option>
                    <option value="3">😭 Organizacja</option>
                    <option value="4">📞 Kontakty</option>
                    <option value="5">Inne</option>
                </select>
                <label for="selectTaskType">Type</label>
            </div>          
            <!--
                https://getbootstrap.com/docs/5.3/forms/layout/

                Layout the form
                +
                Make the Select buttons icons (like 👤 for assigned)
            -->
           
           <!-- temporarily out due to type incompatibility
            <div class="form-floating"> 
                <input type="date" class="form-control" id="selectDueDate" name="due_datetime" placeholder="Due date"/>
                <label for="selectDueDate">Due date</label>
            </div>
            -->
            <div class="form-floating">
                <input type="text" class="form-control" id="taskName" name="name" placeholder="Task Name" required>
                <label for="taskName">Task name</label>
            </div>
            <div class="form-floating">
                <input type="number" name="points" id="taskPoints" class="form-control" placeholder="Points" required>
                <label for="taskPoints">Points</label>
            </div>
            <!-- temporarily out due to type incompatibility
            <div class="form-floating">
                <select class="form-select" id="selectAssigned" name="assigned_to">
                    <option selected>None</option>
                    <option value="1">👤 Person 1</option>
                    <option value="2">👤 Person 2</option>
                    <option value="3">👤 Person 3</option>
                    <option value="4">👤 Person 4</option>
                </select>
                <label for="selectAssigned">Assigned</label>
            </div>
        -->
            <input type="hidden" name="checklist" value="{{checklist.id}}">
            <button type="submit" class="btn">💾</button>
          </div>
    </form>
</div>
</div>